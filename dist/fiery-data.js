!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("FieryData",[],t):"object"==typeof exports?exports.FieryData=t():e.FieryData=t()}(this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=10)}([function(e,t,r){"use strict";function n(e){return"[object Object]"===Object.prototype.toString.call(e)}function o(e){return"string"==typeof e}function a(e){return e&&e instanceof Array}function i(e){return e&&e instanceof Date}function c(e){return void 0!==e}Object.defineProperty(t,"__esModule",{value:!0}),t.isObject=n,t.isFunction=function(e){return"function"==typeof e},t.isString=o,t.isArray=a,t.isDate=i,t.isDefined=c,t.coalesce=function(e,t){return c(e)?e:t},t.isCollectionSource=function(e){return!!e.where},t.getFields=function(e,t){return e?o(e)?[e]:e:t},t.forEach=function(e,t){if(a(e)){for(var r=0;r<e.length;r++)t(e[r],r,e);return!0}if(n(e)){for(var o in e)e.hasOwnProperty(o)&&t(e[o],o,e);return!0}return!1},t.isEqual=function e(t,r){if(t===r)return!0;if(!t||!r)return!1;if(typeof t!=typeof r)return!1;if(a(t)&&a(r)){if(t.length!==r.length)return!1;for(var o=0;o<t.length;o++)if(!e(t[o],r[o]))return!1;return!0}if(i(t)&&i(r))return t.getTime()===r.getTime();if(n(t)&&n(r)){for(var c in t)if(!e(t[c],r[c]))return!1;for(var c in r)if(!(c in t))return!1;return!0}return!1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(4),o=r(7),a=r(9),i=r(3),c=r(2);function s(e,r,o){void 0===o&&(o=!1);var a=e.storeKey+n.UID_SEPARATOR+r.path;if(a in t.globalCache)return d(t.globalCache[a],e,o),t.globalCache[a];var i=e.options.newDocument();i[n.PROP_UID]=a;var s={uid:a,data:i,ref:r,exists:!1,uses:0,sub:{},firstEntry:e,entries:[],removed:!1};return t.globalCache[a]=s,d(s,e,!0),h(i,e),c.callbacks.onCacheCreate(s),s}function u(e){return t.globalCache[e[n.PROP_UID]]}function l(e,t){if(t&&t.uid in e.children){e.options;var r=t.entries,n=r.indexOf(e);-1!==n&&r.splice(n,1),delete e.children[t.uid];for(var a=!1,i=0;i<r.length;i++)if(r[i].instance===e.instance){a=!0;break}if(a||p(t,e.instance,!0),t.uses>0)for(var s in t.sub)f(t,s)||(c.callbacks.onSubDestroy(t.data,s,t),o.closeEntry(t.sub[s],!0))}}function f(e,t){for(var r=e.entries,n=(e.sub,0);n<r.length;n++){var o=r[n].options.sub;if(o&&t in o)return!0}return!1}function d(e,t,r){void 0===r&&(r=!1),e.uid in t.instance.cache||(t.instance.cache[e.uid]=e,e.uses++),e.uid in t.children?r&&g(e,t):(e.entries.push(t),t.children[e.uid]=e,g(e,t))}function p(e,t,r){if(void 0===r&&(r=!0),e.uid in t.cache){e.uses--,delete t.cache[e.uid];for(var n=e.entries,o=n.length-1;o>=0;o--){var a=n[o];a.instance===t&&l(a,e)}r&&e.uses<=0&&v(e)}}function v(e){for(var r=e.entries,n=0;n<r.length;n++)p(e,r[n].instance,!1);for(var a in e.sub)o.closeEntry(e.sub[a],!0);e.uses<=0&&!e.removed&&(c.callbacks.onCacheDestroy(e),delete t.globalCache[e.uid],delete e.ref,delete e.sub,delete e.data,e.entries.length=0,e.removed=!0)}function g(e,t){var r=t.options,i=e.data,s=e.ref;if(r.sub&&s)for(var u in r.sub)if(!y(e,u)){var l=r.sub[u],f=e.uid+n.ENTRY_SEPARATOR+u,d=l.doc?s.parent.doc(e.uid.split(n.PATH_SEPARATOR).pop()+n.PATH_SEPARATOR+u):s.collection(u),p=o.getEntry(t.instance,d,l,f,!1);p.parent=e,e.sub[u]=p,i[u]=a.factory(p),c.callbacks.onSubCreate(i,u,e)}}function y(e,t){return t in e.sub&&e.sub[t].live}function h(e,t){return t.options.record&&Object.defineProperties(e,t.recordProperties),e}t.globalCache={},t.getCacheForReference=s,t.getCacheForDocument=function(e,t,r){return void 0===r&&(r=!1),i.stats.reads++,s(e,t.ref,r)},t.getCacheForData=u,t.removeDataFromEntry=function(e,t){l(e,u(t))},t.removeCacheFromEntry=l,t.isReferencedSub=f,t.addCacheToEntry=d,t.removeCacheFromInstance=p,t.destroyCache=v,t.addSubs=g,t.hasLiveSub=y,t.createRecord=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.callbacks={onInvalidOperation:function(e,t){},onUpdate:function(e,t,r){},onSet:function(e,t,r){},onDelete:function(e,t){},onClear:function(e,t){},onGetChanges:function(e,t,r){},onBuild:function(e,t){},onCacheCreate:function(e){},onCacheDestroy:function(e){},onSubCreate:function(e,t,r){},onSubDestroy:function(e,t,r){},onCollectionAdd:function(e,t,r){},onCollectionRemove:function(e,t,r){},onCollectionModify:function(e,t,r){},onCollectionChanged:function(e,t){},onDocumentUpdate:function(e,t){},onDocumentMissing:function(e,t){},onInstanceCreate:function(e){},onInstanceDestroy:function(e){}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stats={queries:0,reads:0,deletes:0,updates:0,sets:0,writes:0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PROP_VALUE=".value",t.PROP_UID=".uid",t.UID_SEPARATOR="///",t.ENTRY_SEPARATOR="/",t.PATH_SEPARATOR="/",t.RECORD_OPTIONS={sync:"$sync",update:"$update",save:"$save",remove:"$remove",ref:"$ref",clear:"$clear",build:"$build",create:"$create",getChanges:"$getChanges"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);function o(e,t,r){for(var n in r)e.setProperty(t,n,r[n]);return t}function a(e,t){if(t.decode)e=t.decode(e);else if(t.decoders)for(var r in t.decoders)r in e&&(e[r]=t.decoders[r](e[r],e));return e}function i(e,t){var r,o=e.data(),a=n.isObject(o)?o:((r={})[t.propValue]=o,r);return a&&t.key&&(a[t.key]=e.id),a}t.refreshData=function(e,t,r){var n=r.instance.system,c=r.options,s=a(i(t,c),c),u=e.data;return o(n,u,s),c.propExists&&n.setProperty(u,c.propExists,t.exists),c.propParent&&r.parent&&n.setProperty(u,c.propParent,r.parent.data),e.exists=t.exists,u},t.copyData=o,t.decodeData=a,t.encodeData=function(e,t,r){var o={},a=n.getFields(r,t.include);if(a)for(var i=0;i<a.length;i++)(c=a[i])in e&&(o[c]=e[c]);else for(var c in e)c in t.exclude||(o[c]=e[c]);if(t.encoders)for(var c in t.encoders)c in o&&(o[c]=t.encoders[c](o[c],e));return o},t.parseDocument=i},function(e,t,r){"use strict";var n=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e};Object.defineProperty(t,"__esModule",{value:!0});var o=r(4),a=r(0);function i(e,r){if(r)for(var n in t.mergeOptions){var o=n,a=t.mergeOptions[o];e[o]=a(e[o],r[o])}}t.globalOptions={defined:{},user:void 0,defaults:{onError:function(e){},onMissing:function(){},onSuccess:function(e){},onRemove:function(){},liveOptions:{},propValue:o.PROP_VALUE,recordOptions:o.RECORD_OPTIONS,newDocument:function(e){return{}}},id:0,map:{}},t.getOptionsByKey=function(e){return t.globalOptions.map[parseInt(e)]},t.getOptions=function e(r,n){if(a.isString(r)){if(!(r in t.globalOptions.defined))throw"The definition "+r+" was not found. You must call define before you use the definition";return e(t.globalOptions.defined[r])}if(r&&a.isObject(r)||(r={}),r.id&&r.id in t.globalOptions.map)return r;if(r.id||(r.id=++t.globalOptions.id,t.globalOptions.map[r.id]=r),r.extends&&i(r,e(r.extends)),i(r,t.globalOptions.user),i(r,t.globalOptions.defaults),n&&!r.shared&&(r.instance=n,n.options[r.id]=r),r.type){var c=r.type;r.newDocument=function(e){return new c}}r.newCollection||(r.newCollection=r.map?function(){return{}}:function(){return[]});var s={};if(r.exclude?a.isArray(r.exclude)?a.forEach(r.exclude,function(e,t){return s[e]=!0}):s=r.exclude:r.key&&(s[r.key]=!0),s[r.propValue]=!0,s[o.PROP_UID]=!0,a.forEach(r.recordOptions,function(e,t){return s[e]=!0}),r.exclude=s,r.sub)for(var u in r.sub){var l=e(r.sub[u],n);l.parent=r,r.sub[u]=l,l.ref||(s[u]=!0)}return r},t.recycleOptions=function(e){var t=e.instance;t&&delete t.options[e.id]},t.define=function(e,r){if(a.isString(e))(o=r).shared=!0,t.globalOptions.defined[e]=o;else for(var n in e){var o;(o=e[n]).shared=!0,t.globalOptions.defined[n]=o}},t.setGlobalOptions=function(e){e&&(e.shared=!0),t.globalOptions.user=e},t.performMerge=i,t.mergeStrategy={ignore:function(e,t){return e},replace:function(e,t){return a.coalesce(e,t)},chain:function(e,t){return a.isDefined(t)?a.isDefined(e)?function(){t.apply(this,arguments)(e).apply(this,arguments)}:t:e},shallow:function(e,t){return a.isDefined(t)?a.isDefined(e)?n({},t,e):t:e},concat:function(e,t){if(!a.isDefined(t))return e;if(!a.isDefined(e))return t;if(a.isArray(e)&&a.isArray(t)){for(var r=e.concat(t),n={},o=r.length-1;o>=0;o--)r[o]in n?r.splice(o,1):n[r[o]]=!0;return r}},exclude:function(e,r){var n=t.mergeStrategy.concat(e,r);if(!n&&e&&r){var o={},i=a.isArray(r),c=a.isArray(e);return a.forEach(r,function(e,t){return e?o[i?e:t]=!0:0}),a.forEach(e,function(e,t){return e?o[c?e:t]=!0:0}),o}return n}},t.mergeOptions={extends:t.mergeStrategy.ignore,id:t.mergeStrategy.ignore,parent:t.mergeStrategy.ignore,shared:t.mergeStrategy.ignore,vm:t.mergeStrategy.ignore,key:t.mergeStrategy.replace,query:t.mergeStrategy.replace,map:t.mergeStrategy.replace,once:t.mergeStrategy.replace,type:t.mergeStrategy.replace,nullifyMissing:t.mergeStrategy.replace,newDocument:t.mergeStrategy.replace,newCollection:t.mergeStrategy.replace,decode:t.mergeStrategy.replace,decoders:t.mergeStrategy.shallow,encoders:t.mergeStrategy.shallow,record:t.mergeStrategy.replace,recordOptions:t.mergeStrategy.replace,recordFunctions:t.mergeStrategy.replace,propValue:t.mergeStrategy.replace,propExists:t.mergeStrategy.replace,propParent:t.mergeStrategy.replace,onceOptions:t.mergeStrategy.replace,liveOptions:t.mergeStrategy.replace,include:t.mergeStrategy.concat,exclude:t.mergeStrategy.exclude,onError:t.mergeStrategy.replace,onSuccess:t.mergeStrategy.replace,onMissing:t.mergeStrategy.replace,onRemove:t.mergeStrategy.replace,sub:t.mergeStrategy.shallow}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(6),a=r(11),i=r(1),c=r(8);function s(e,t){if(void 0===t&&(t=!1),e&&e.live&&(e.off&&(e.off(),delete e.off),e.live=!1,t)){var r=e.instance;n.isDefined(e.index)&&(r.entryList[e.index]=null,delete e.index),e.name&&e.name in r.entry&&delete r.entry[e.name],n.forEach(e.children,function(t){i.removeCacheFromEntry(e,t)})}}function u(e){return{sync:function(t){return c.sync.call(e,this,t)},update:function(t){return c.update.call(e,this,t)},save:function(t){return c.save.call(e,this,t)},remove:function(t){return void 0===t&&(t=!1),c.remove.call(e,this,t)},ref:function(t){return c.ref.call(e,this,t)},clear:function(t){return c.clear.call(e,this,t)},build:function(t,r){return c.buildSub.call(e,this,t,r)},create:function(t,r){return c.createSub.call(e,this,t,r)},getChanges:function(t,r){return c.getChanges.call(e,this,t,r)}}}function l(e,t){var r={};for(var n in e.recordOptions){r[e.recordOptions[n]]={value:t[n]}}return r}t.closeEntry=s,t.getEntry=function(e,t,r,n,i){void 0===i&&(i=!0);var c=o.getOptions(r,e),f=a.getStoreKey(t);if(n&&n in e.entry){var d=e.entry[n];return s(d),c.id!==d.options.id&&o.recycleOptions(d.options),d.source=t,d.options=c,d.storeKey=f,d.live=!0,n&&i&&(e.sources[n]=t),d}var p=u(e),v={name:n,options:c,source:t,instance:e,storeKey:f,children:{},recordFunctions:p,recordProperties:l(c,p),live:!0};return n&&n in e.entry||(v.index=e.entryList.length,e.entryList.push(v)),n&&(e.entry[n]=v),n&&i&&(e.sources[n]=t),v},t.getEntryRecordFunctions=u,t.getEntryRecordProperties=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5),o=r(0),a=r(1),i=r(3),c=r(2);function s(e,t){var r=this;void 0===t&&(t=!1);var n=a.getCacheForData(e);if(n&&n.ref){var u=n.firstEntry.options;if(!t&&u.sub)for(var l in u.sub)o.forEach(e[l],function(e){s.call(r,e)});return i.stats.deletes++,c.callbacks.onDelete(e,n),n.ref.delete()}return c.callbacks.onInvalidOperation(e,"remove"),Promise.reject("The given data is out of scope and cannot be operated on.")}function u(e,t,r){var n=t.options,i=e.doc(),s=a.getCacheForReference(t,i);return n.defaults&&o.forEach(n.defaults,function(e,t){r&&t in r||(s.data[t]=o.isFunction(e)?e():e)}),r&&o.forEach(r,function(e,t){s.data[t]=e}),c.callbacks.onBuild(s.data,s),s.data}t.save=function(e,t){var r=a.getCacheForData(e);if(r&&r.ref){var o=r.firstEntry.options,s=n.encodeData(e,o,t);return r.exists?(i.stats.writes++,i.stats.updates++,c.callbacks.onUpdate(e,s,r),r.ref.update(s)):r.ref.get().then(function(t){if(i.stats.writes++,t.exists)return i.stats.updates++,c.callbacks.onUpdate(e,s,r),r.ref.update(s);var a=n.encodeData(e,o);return i.stats.sets++,c.callbacks.onSet(e,a,r),r.ref.set(a)})}return c.callbacks.onInvalidOperation(e,"save"),Promise.reject("The given data is out of scope and cannot be operated on.")},t.update=function(e,t){var r=a.getCacheForData(e);if(r&&r.ref){var o=r.firstEntry.options,s=n.encodeData(e,o,t);return i.stats.writes++,i.stats.updates++,c.callbacks.onUpdate(e,s,r),r.ref.update(s)}return c.callbacks.onInvalidOperation(e,"update"),Promise.reject("The given data is out of scope and cannot be operated on.")},t.sync=function(e,t){var r=a.getCacheForData(e);if(r&&r.ref){var o=r.firstEntry.options,s=n.encodeData(e,o,t);return i.stats.sets++,i.stats.writes++,c.callbacks.onSet(e,s,r),r.ref.set(s)}return c.callbacks.onInvalidOperation(e,"sync"),Promise.reject("The given data is out of scope and cannot be operated on.")},t.remove=s,t.clear=function(e,t){var r=this,n=a.getCacheForData(e),u=o.getFields(t);if(n&&n.ref){for(var l=n.firstEntry.options,f=n.ref,d=f.firestore,p=[],v={},g=0,y=0,h=u;y<h.length;y++){var b=h[y];if(l.sub&&b in l.sub&&e[b])o.forEach(e[b],function(e){p.push(s.call(r,e))});else if(b in e){var m=d.app.firebase_;m&&(v[b]=m.firestore.FieldValue.delete(),g++)}}return g>0&&(i.stats.updates++,i.stats.writes++,p.push(f.update(v))),c.callbacks.onClear(e,u),Promise.all(p)}return c.callbacks.onInvalidOperation(e,"clear"),Promise.reject("The given data is out of scope and cannot be operated on.")},t.getChanges=function(e,t,r){var s=a.getCacheForData(e);if(s&&s.ref){var u=o.isFunction(t)?void 0:o.getFields(t),l=(u?r:t)||o.isEqual,f=s.firstEntry.options,d=n.encodeData(e,f,u);return i.stats.reads++,c.callbacks.onGetChanges(e,s,u),s.ref.get().then(function(e){var t=n.parseDocument(e,f),r={},o={},a=!1;for(var i in d){var c=t[i],s=d[i];l(c,s)||(a=!0,r[i]=c,o[i]=s)}return Promise.resolve({changed:a,remote:r,local:o})})}return c.callbacks.onInvalidOperation(e,"getChanges"),Promise.reject("The given data is out of scope and cannot be operated on.")},t.ref=function(e,t){var r=a.getCacheForData(e);if(r&&r.ref){var n=r.ref;return t?n.collection(t):n}throw"The given data is out of scope and cannot be referenced."},t.create=function(e,t){var r=this.build(e,t);return r&&this.sync(r),r},t.createSub=function(e,t,r){var n=this.buildSub(e,t,r);return n&&this.sync(n),n},t.build=function(e,t){var r;if(o.isString(e)){if(e in this.entry)return u((r=this.entry[e]).source,r,t)}else if(r=this.entryFor(e))return u(r.source,r,t);throw"Cannot build "+e+NaN},t.buildSub=function(e,t,r){var n=a.getCacheForData(e);if(n&&n.ref&&t in n.sub){var o=n.sub[t];return u(n.ref.collection(t),o,r)}throw"Cannot build in the sub collection "+t+NaN},t.buildFromCollection=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(12),o=r(13),a=r(14);function i(e){return(e.source.where?e.options.map?o.default:a.default:n.default)(e)}t.factory=i,t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(6);t.define=n.define,t.setGlobalOptions=n.setGlobalOptions,t.mergeStrategy=n.mergeStrategy,t.mergeOptions=n.mergeOptions;var o=r(1);t.getCacheForData=o.getCacheForData,t.destroyCache=o.destroyCache;var a=r(15),i=r(3);t.stats=i.stats;var c=r(2);t.callbacks=c.callbacks,function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(4)),t.default=a.getInstance},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stores={keyNext:0,map:{},idToKey:{}},t.getStoreKey=function(e){var r=e.firestore,n=r.app.name,o=t.stores.idToKey[n];return o||(o=++t.stores.keyNext,t.stores.map[o]=r,t.stores.idToKey[n]=o),o}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5),o=r(1),a=r(3),i=r(2);function c(e){var t=e.source,r=e.options,n=o.getCacheForReference(e,t,!0),i=e.target,c=!1,u=function(t){s(n,e,t),c=!t.exists};return i&&i!==n.data&&o.removeDataFromEntry(e,i),e.target=n.data,a.stats.queries++,r.once?e.promise=t.get(r.onceOptions).then(u).catch(r.onError):e.off=t.onSnapshot(r.liveOptions,u,r.onError),c&&r.nullifyMissing?null:e.target}function s(e,t,r){var a=t.options,c=t.instance.system;r.exists?(n.refreshData(e,r,t),a.onSuccess(e.data),i.callbacks.onDocumentUpdate(e.data,t)):(i.callbacks.onDocumentMissing(e.data,t),a.propExists&&c.setProperty(e.data,a.propExists,!1),e.exists=!1,a.nullifyMissing&&(o.destroyCache(e),t.name&&c.removeNamed(t.name)))}t.factory=c,t.handleDocumentUpdate=s,t.default=c},function(e,t,r){"use strict";var n=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e};Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=r(5),i=r(1),c=r(3),s=r(2);t.default=function(e){var t=e.options,r=t.query?t.query(e.source):e.source,u=function(e){var t=e.options,r=e.instance.system;return function(c){var u=e.target,l=n({},u);c.forEach(function(t){var n=i.getCacheForDocument(e,t,!0);a.refreshData(n,t,e),r.setProperty(u,t.id,n.data),delete l[t.id],s.callbacks.onCollectionAdd(n.data,u,e)},t.onError),o.forEach(l,function(e,t){return r.removeProperty(u,t)}),o.forEach(l,function(t){s.callbacks.onCollectionRemove(t,u,e),i.removeDataFromEntry(e,t)}),t.onSuccess(u),s.callbacks.onCollectionChanged(u,e)}}(e);return e.target||(e.target=t.newCollection()),c.stats.queries++,t.once?e.promise=r.get(t.onceOptions).then(u).catch(t.onError):e.off=r.onSnapshot(t.liveOptions,function(e,t){var r=function(e){var t=e.options,r=e.instance.system;return function(n){var o=e.target;n.docChanges().forEach(function(n){var c=n.doc,u=i.getCacheForDocument(e,c);switch(n.type){case"modified":var l=a.refreshData(u,c,e);r.setProperty(o,c.id,l),s.callbacks.onCollectionModify(l,o,e);break;case"added":var f=a.refreshData(u,c,e);r.setProperty(o,c.id,f),s.callbacks.onCollectionAdd(f,o,e);break;case"removed":s.callbacks.onCollectionRemove(u.data,o,e),r.removeProperty(o,c.id),c.exists?i.removeCacheFromEntry(e,u):(t.propExists&&r.setProperty(u.data,t.propExists,!1),u.exists=!1,i.destroyCache(u))}},t.onError),t.onSuccess(o),s.callbacks.onCollectionChanged(o,e)}}(e),n=t;return function(e){n(e),n=r}}(e,u),t.onError),e.target}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(4),o=r(5),a=r(1),i=r(0),c=r(3),s=r(2);function u(e){var t=e.options,r=t.query?t.query(e.source):e.source,u=function(e){var t=e.options,r=e.instance.system,c=e.target;return function(u){var l=e.target,f={};if(c)for(var d=0;d<l.length;d++){var p=l[d];f[p[n.PROP_UID]]=p}r.arrayResize(l,0),u.forEach(function(t){var n=a.getCacheForDocument(e,t,!0);o.refreshData(n,t,e),r.arrayAdd(l,n.data),delete f[n.uid],s.callbacks.onCollectionAdd(n.data,l,e)},t.onError),i.forEach(f,function(t){s.callbacks.onCollectionRemove(t,l,e),a.removeDataFromEntry(e,t)}),t.onSuccess(l),s.callbacks.onCollectionChanged(l,e)}}(e);return e.target||(e.target=t.newCollection()),c.stats.queries++,t.once?e.promise=r.get(t.onceOptions).then(u).catch(t.onError):e.off=r.onSnapshot(t.liveOptions,function(e,t){var r=function(e){var t=e.options,r=e.instance.system;return function(n){var i=e.target;n.docChanges().forEach(function(n){var c=n.doc,u=a.getCacheForDocument(e,c);switch(n.type){case"added":var l=o.refreshData(u,c,e);r.arraySet(i,n.newIndex,l),s.callbacks.onCollectionAdd(l,i,e);break;case"removed":s.callbacks.onCollectionRemove(u.data,i,e),c.exists?a.removeCacheFromEntry(e,u):(t.propExists&&r.setProperty(u.data,t.propExists,!1),u.exists=!1,a.destroyCache(u));break;case"modified":var f=o.refreshData(u,c,e);n.oldIndex!==n.newIndex&&r.arraySet(i,n.newIndex,f),s.callbacks.onCollectionModify(f,i,e)}},t.onError),r.arrayResize(i,n.size),t.onSuccess(i),s.callbacks.onCollectionChanged(i,e)}}(e),n=t;return function(e){n(e),n=r}}(e,u),t.onError),e.target}t.factory=u,t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(9),a=r(7),i=r(1),c=r(6),s=r(2),u=r(8);function l(){var e=this;n.forEach(this.options,function(e){return delete c.globalOptions.map[e.id]}),n.forEach(this.cache,function(t){return i.removeCacheFromInstance(t,e)}),n.forEach(this.entryList,function(e){return a.closeEntry(e,!0)}),this.entry={},this.entryList=[],this.options={},this.sources={},this.cache={},s.callbacks.onInstanceDestroy(this)}function f(e){var t=this.entryFor(e);null!==t&&a.closeEntry(t,!0)}function d(e){for(var t=this.entryList,r=0;r<t.length;r++){var n=t[r];if(n&&n.target===e)return n}return null}function p(e){for(var t=this.entryList,r=0;r<t.length;r++){var n=t[r];if(null!==n)if(!n.options.parent&&!n.name)for(var o in e)if(e[o]===n.target){n.name=o,this.entry[o]=n,this.sources[o]=n.source;break}}}t.getInstance=function(e){var t=function(e){var t=e||{};for(var r in v){var n=r;n in t||(t[n]=v[n])}return t}(e),r=function(e,t,n){return o.factory(a.getEntry(r,e,t,n))};return r.system=t,r.entry={},r.entryList=[],r.options={},r.sources={},r.cache={},r.update=u.update,r.save=u.save,r.sync=u.sync,r.remove=u.remove,r.clear=u.clear,r.getChanges=u.getChanges,r.ref=u.ref,r.create=u.create,r.createSub=u.createSub,r.build=u.build,r.buildSub=u.buildSub,r.entryFor=d,r.destroy=l,r.free=f,r.linkSources=p,s.callbacks.onInstanceCreate(r),r};var v={removeNamed:function(e){},setProperty:function(e,t,r){e[t]=r},removeProperty:function(e,t){delete e[t]},arraySet:function(e,t,r){e[t]=r},arrayAdd:function(e,t){e.push(t)},arrayResize:function(e,t){e.length=t}}}])});
//# sourceMappingURL=fiery-data.js.map